# TrollTouch - 前台透明模式说明

## 方案概述

**完全前台透明模式**：TrollTouch 保持在前台，使用几乎完全透明的全屏界面。用户可以透过 TrollTouch 看到并操作 TikTok。

## 工作原理

### 1. 全屏透明窗口
- **尺寸**：覆盖整个屏幕
- **背景**：几乎完全透明（alpha = 0.02，肉眼几乎看不见）
- **触摸穿透**：`userInteractionEnabled = NO`，所有触摸都会穿透到下层

### 2. 小控制面板
- **位置**：屏幕右上角
- **尺寸**：100x80 像素
- **内容**：
  - 🤖 运行中
  - 操作计数
  - "前台模式" 标识
- **可交互**：控制面板本身可以接收触摸（用于未来的停止按钮等）

### 3. 关键技术点

```objectivec
// 全屏透明窗口
_overlayWindow.backgroundColor = [UIColor clearColor];
_overlayWindow.userInteractionEnabled = NO;  // 触摸穿透

// 几乎不可见的背景提示
hintView.backgroundColor = [UIColor colorWithWhite:0 alpha:0.02];

// 小控制面板可交互
controlPanel.userInteractionEnabled = YES;
```

## 为什么这个方案可以工作

1. **TrollTouch 保持前台**：iOS 允许前台应用的窗口显示
2. **触摸穿透**：`userInteractionEnabled = NO` 让触摸事件传递到下层
3. **IOHIDEventSystemClient 可用**：前台应用可以注入触摸事件

## 用户体验

### ✅ 优点
- 触摸注入可以工作
- 用户可以看到 TikTok 内容
- 几乎不影响视觉体验（背景几乎透明）
- 小控制面板显示运行状态

### ⚠️ 缺点
- TrollTouch 必须保持前台（不能切换到其他应用）
- 控制面板会遮挡一小部分屏幕
- 如果用户按 Home 键，自动化会停止

## 使用方法

1. **启动自动化**
   - 点击 "START" 按钮
   - 看到通知："自动化服务已启动 (前台透明模式)"

2. **观察状态**
   - 右上角会出现小控制面板
   - 显示 "🤖 运行中"
   - 背景几乎完全透明

3. **自动化运行**
   - TikTok 会自动启动
   - 自动点赞、滑动、关注
   - 你可以看到所有操作

4. **停止自动化**
   - 点击 "STOP" 按钮
   - 或者切换到其他应用（会自动停止）

## 技术限制

1. **必须保持前台**：这是核心要求，无法绕过
2. **不能锁屏**：锁屏会导致应用进入后台
3. **不能切换应用**：切换会导致 TrollTouch 进入后台

## 测试要点

1. ✅ 启动后，屏幕应该几乎看不出有覆盖层
2. ✅ 右上角应该有小控制面板
3. ✅ TikTok 应该可以正常显示
4. ✅ 触摸事件应该能够生效（点赞、滑动）
5. ⚠️ 保持 TrollTouch 在前台，不要切换应用

## 下一步改进

如果这个方案可行，可以添加：
1. **拖拽控制面板**：让用户可以移动控制面板位置
2. **快捷停止按钮**：在控制面板上添加停止按钮
3. **透明度调节**：让用户可以调整背景透明度
4. **操作计数器**：实时显示已执行的操作数量

## 故障排查

**如果触摸仍然无效**：
1. 确认 TrollTouch 在前台（不是后台）
2. 检查日志中是否有 `[TouchSim] Dispatching` 消息
3. 尝试手动点击 TikTok，确认触摸穿透工作
4. 如果还是不行，可能需要越狱方案

**如果看不到 TikTok**：
1. 检查背景透明度是否正确（应该是 alpha = 0.02）
2. 确认窗口层级是 `UIWindowLevelNormal`
3. 尝试调整透明度值
